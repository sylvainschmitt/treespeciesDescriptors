```{r setupperf, include=FALSE, eval=T}
rm(list = ls()) ; invisible(gc()) ; set.seed(42)
library(knitr)
library(tidyverse)
ggplot2::theme_set(bayesplot::theme_default())
opts_chunk$set(
  echo = T, message = F, warning = F, fig.height = 6, fig.width = 8,
  cache = T, cache.lazy = F, eval=T)
```


# Performance descriptors

## Growth

```{r growthdata, eval=F}
vroom::vroom("data/paracou.tsv") %>% 
  filter(BotaSource == "Bota") %>% 
  group_by(Genus, Species, idTree) %>% 
  arrange(CensusYear) %>% 
  mutate(FirstDead = first(CensusYear[CodeAlive == 0])) %>% 
  mutate(FirstDead = ifelse(is.na(FirstDead), max(CensusYear)+1, FirstDead)) %>% 
  filter(CensusYear < FirstDead) %>% 
  summarise(AGR = (last(DBH) - first(DBH))/(last(CensusYear) - first(CensusYear))) %>% 
  na.omit() %>% 
  group_by(Genus, Species) %>% 
  summarise(AGR = median(AGR)) %>% 
  vroom::vroom_write("data/species_growth.tsv")
```

```{r growthtab}
vroom::vroom("data/species_growth.tsv") %>% 
  kable(caption = "Median of annual growth rate of all individuals across species (cm/year).") 
```

## Mortality

```{r mortalitydata, eval=F}
vroom::vroom("data/paracou.tsv") %>% 
  group_by(Genus, Species) %>% 
  summarise(death = sum(CodeAlive == 0), trees = length(unique(idTree)), time = max(CensusYear) - min(CensusYear)) %>% 
  transmute(mortality = death / trees / time * 100) %>% 
  vroom::vroom_write("data/species_mortality.tsv")
```

```{r mortalitytab}
vroom::vroom("data/species_mortality.tsv") %>% 
  kable(caption = "Annual mortality rate across species (%/year).") 
```
